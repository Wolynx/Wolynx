#include <WiFi.h>
#include <WebServer.h>
#include <DHT.h>

// Wi-Fi bilgileri
const char* ssid = "Wifi Ad";
const char* password = "Sifre";

// DHT sensÃ¶r ayarlarÄ±
#define DHTPIN 13  // SensÃ¶rÃ¼n baÄŸlÄ± olduÄŸu pin
#define DHTTYPE DHT11 // veya DHT22
DHT dht(DHTPIN, DHTTYPE);

// Web sunucu nesnesi
WebServer server(80);

// Konum Bilgisi
const char* location = "Ä°zmir/Buca - Volkan'Ä±n Evi"; // Konum
const char* country = "TÃ¼rkiye";

// HTML SayfasÄ±
String readSensorData() {
    float h = dht.readHumidity();
    float t = dht.readTemperature();
    
    if (isnan(h) || isnan(t)) {
        return "SensÃ¶r okunamadÄ±!";
    }

    String html = "<html><head>";
    html += "<meta charset='UTF-8'>"; // Karakter bozulmalarÄ±nÄ± Ã¶nler
    html += "<meta http-equiv='refresh' content='5'/>";
    html += "<title>SÄ±caklÄ±k ve Nem Ã–lÃ§er</title>";
    
    // Saat GÃ¼ncelleme Scripti
    html += "<script>function updateTime() {";
    html += "var now = new Date();";
    html += "document.getElementById('clock').innerHTML = now.toLocaleTimeString('tr-TR');";
    html += "} setInterval(updateTime, 1000);</script>";
    
    // CSS TasarÄ±mÄ±
    html += "<style>";
    html += "body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f4; }";
    html += ".container { margin-top: 50px; padding: 20px; background: white; display: inline-block; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); }";
    html += ".data { font-size: 20px; margin: 10px 0; }";
    html += ".icon { font-size: 30px; margin-right: 10px; }";
    html += "footer { position: fixed; right: 10px; bottom: 10px; font-size: 12px; color: gray; }";
    html += "</style></head><body onload='updateTime()'>";

    // Sayfa Ä°Ã§eriÄŸi
    html += "<div class='container'>";
    html += "<h1>SÄ±caklÄ±k ve Nem Ã–lÃ§er</h1>";
    html += "<p class='data'><span class='icon'>ğŸŒ¡ï¸</span><strong>SÄ±caklÄ±k:</strong> " + String(t) + " Â°C</p>";
    html += "<p class='data'><span class='icon'>ğŸ’§</span><strong>Nem:</strong> " + String(h) + " %</p>";
    html += "<p class='data'><span class='icon'>ğŸ“</span><strong>Konum:</strong> " + String(location) + "</p>";
    html += "<p class='data'><span class='icon'>ğŸŒ</span><strong>Ãœlke:</strong> " + String(country) + "</p>";
    html += "<p class='data'><span class='icon'>â°</span><strong>Saat:</strong> <span id='clock'></span></p>";
    html += "</div>";

    html += "<footer>Bu web sayfasÄ±nÄ±n tasarÄ±mÄ± Volkan Ã–zdemirâ„¢ 'e aittir.</footer>";

    html += "</body></html>";
    
    return html;
}

// Ana sayfa isteÄŸi iÅŸlendiÄŸinde Ã§alÄ±ÅŸacak fonksiyon
void handleRoot() {
    server.send(200, "text/html", readSensorData());
}

void setup() {
    Serial.begin(115200);
    dht.begin();

    // WiFi baÄŸlantÄ±sÄ±
    WiFi.begin(ssid, password);
    Serial.print("WiFi'ye baÄŸlanÄ±lÄ±yor");
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.print(".");
    }
    Serial.println("\nWiFi baÄŸlandÄ±!");
    Serial.print("ESP32 IP Adresi: ");
    Serial.println(WiFi.localIP());

    // Web sunucusunu baÅŸlat
    server.on("/", handleRoot);
    server.begin();
}

void loop() {
    server.handleClient(); // Ä°stemcileri dinle
}
